# ===================================================================
# apogee config v2 (modules-first)
#
# Goals:
#   - apogee detects context (platform, shell, host)
#   - modules decide if they are ACTIVE based on detection rules
#   - ONLY active modules emit env/paths/aliases/functions/snippets
#
# Philosophy:
#   - "global" should only contain things that depend on platform/shell,
#     not on whether Dropbox/git/etc exists.
#   - Anything that depends on an app/service/root path should live in a module.
#
# Detection model (per module):
#   - detect.paths.<platform>.any_of: folder exists -> module active
#   - detect.commands.any_of: command exists in PATH -> module active
#   - detect.files.<platform>.any_of: file/glob exists -> module active (desktop apps)
#   - detect.env.any_of: env var present -> module active (optional)
#
# Emission model (per module, only when active):
#   - emit.env: sets env vars (shell-specific export/set semantics handled by apogee)
#   - emit.paths: prepend/append PATH entries if they exist
#   - emit.aliases: aliases (or functions-on-fish if you choose)
#   - emit.functions: load functions (prefer files), and/or inline
# ===================================================================

[apogee]
schema_version = 2

default_shell  = "zsh"
platforms      = ["mac", "linux", "windows", "wsl", "other"]

env_file       = "{config_dir}/.env"
secrets_file   = "{config_dir}/secrets.env"

[apogee.bootstrap.defaults.env]
XDG_CONFIG_HOME = "{home}/.config"
XDG_CACHE_HOME  = "{home}/.cache"
XDG_DATA_HOME   = "{home}/.local/share"
XDG_STATE_HOME  = "{home}/.local/state"

[apogee.bootstrap.secrets]
strategy = "fill_missing" # "fill_missing" | "override"


[modules]
enable_cloud = true
enable_apps  = true
enable_hooks = true
enable_templates = true

# ===================================================================
# GLOBAL (platform/shell only)
# ===================================================================

[global]

[global.env]
XDG_CONFIG_HOME = "{home}/.config"

[global.aliases.platform.mac]
o     = "open ."
bindu = "cd {xdg_config_home}"

[global.aliases.platform.linux]
o = "xdg-open ."
bindu = "cd {xdg_config_home}"

[global.aliases.platform.windows]
o = "explorer.exe ."

[global.aliases.platform.wsl]
o = "explorer.exe ."


# ===================================================================
# MODULES: CLOUD
# ===================================================================

[modules.cloud]
enabled = true

# -------------------------------------------------------------------
# dropbox  (DROPBOX/MATRIX/DOCKER/BASE_DIR/PACKAGES/CRATES/OBSIDIAN)
# -------------------------------------------------------------------
[modules.cloud.dropbox]
enabled   = true
kind      = "storage"
platforms = ["mac", "linux", "windows", "wsl", "other"]

[modules.cloud.dropbox.detect.paths.mac]
any_of = [
  "{home}/Library/CloudStorage/Dropbox",
  "{home}/Dropbox",
]

[modules.cloud.dropbox.detect.paths.linux]
any_of = ["{home}/Dropbox"]

[modules.cloud.dropbox.detect.paths.windows]
any_of = ["{userprofile}/Dropbox"]

[modules.cloud.dropbox.detect.paths.wsl]
any_of = [
  "{userprofile}/Dropbox",
  "/mnt/c/Users/{username}/Dropbox",
]

[modules.cloud.dropbox.detect.paths.other]
any_of = ["{home}/Dropbox"]

[modules.cloud.dropbox.emit.env]
DROPBOX = "{detect.path}"

[modules.cloud.dropbox.emit.env_derived]
MATRIX   = "$DROPBOX/matrix"
DOCKER   = "$MATRIX/docker"
BASE_DIR = "$MATRIX/shellscripts"
PACKAGES = "$MATRIX/packages"
CRATES   = "$MATRIX/crates"
OBSIDIAN = "$MATRIX/obsidian/jnanaKosha"
CREDENTIALS_PATH = "$MATRIX/config/credentials"

[modules.cloud.dropbox.emit.aliases]
matrix   = "cd \"$MATRIX\""
packages = "cd \"$PACKAGES\""
crates   = "cd \"$CRATES\""

orbit    = "cd \"$DROPBOX/matrix/orbit\""
helix    = "cd \"$DROPBOX/matrix/helix\""
tessera  = "cd \"$DROPBOX/matrix/tessera\""

apogee_repo   = "cd \"$DROPBOX/matrix/crates/apogee\""
rusk     = "cd \"$DROPBOX/matrix/crates/rusk\""

[modules.cloud.dropbox.emit.paths]
prepend_if_exists = ["$DROPBOX/matrix/bin"]
append_if_exists  = []


# -------------------------------------------------------------------
# dataLib  (your corrected paths)
# -------------------------------------------------------------------
[modules.cloud.dataLib]
enabled   = true
kind      = "storage"
platforms = ["mac", "linux", "windows", "wsl", "other"]

[modules.cloud.dataLib.detect.paths.mac]
any_of = [
  "{home}/Library/CloudStorage/SynologyDrive-dataLib",
  "{home}/dataLib",
]

[modules.cloud.dataLib.detect.paths.linux]
any_of = ["/mnt/dataLib"]

[modules.cloud.dataLib.detect.paths.windows]
any_of = ["{userprofile}/dataLib"]

[modules.cloud.dataLib.detect.paths.wsl]
any_of = [
  "{userprofile}/dataLib",
  "/mnt/c/Users/{username}/dataLib",
]

[modules.cloud.dataLib.detect.paths.other]
any_of = ["{home}/dataLib"]

[modules.cloud.dataLib.emit.env]
DATALIB = "{detect.path}"

[modules.cloud.dataLib.emit.env_derived]
ML4VFX = "$DATALIB/threeD/courses/05_Machine_Learning_in_VFX"

# -------------------------------------------------------------------
# nebula_ai (ZFS share from zion; only active when mounted)
# -------------------------------------------------------------------
[modules.cloud.nebula_ai]
enabled   = true
kind      = "storage"
platforms = ["mac", "linux", "windows", "wsl", "other"]

[modules.cloud.nebula_ai.detect.paths.mac]
any_of = [
  "/Volumes/ai",
  "/Volumes/nebula_ai",
]

[modules.cloud.nebula_ai.detect.paths.linux]
any_of = [
  "/mnt/ai",
  "/mnt/nebula_ai",
]

[modules.cloud.nebula_ai.detect.paths.wsl]
any_of = [
  "/mnt/z/ai",
  "/mnt/z/nebula_ai",
]

[modules.cloud.nebula_ai.detect.paths.windows]
any_of = [
  "Z:\\ai",
  "Z:\\nebula_ai",
]

[modules.cloud.nebula_ai.detect.paths.other]
any_of = [
  "{home}/ai",
]

[modules.cloud.nebula_ai.emit.env]
NEBULA_AI_ROOT = "{detect.path}"

[modules.cloud.nebula_ai.emit.env_derived]
NEBULA_AI_MODELS       = "$NEBULA_AI_ROOT/models"
NEBULA_AI_DATASETS     = "$NEBULA_AI_ROOT/datasets"
NEBULA_AI_EXPERIMENTS  = "$NEBULA_AI_ROOT/experiments"
NEBULA_AI_LOGS         = "$NEBULA_AI_ROOT/logs"
NEBULA_AI_SCRIPTS      = "$NEBULA_AI_ROOT/scripts"
NEBULA_AI_PROJECTS     = "$NEBULA_AI_ROOT/projects"

# --------------------------------------------------
# scratch_paths (mac-only, local convenience paths)
# --------------------------------------------------
[modules.cloud.scratch_paths]
enabled   = true
kind      = "storage"
platforms = ["mac"]

# Activate only if at least one of these exists
[modules.cloud.scratch_paths.detect.paths.mac]
any_of = [
  "{home}/Documents/Scratch"
]

# Emit them regardless; if you want strictness per-path, see note below
[modules.cloud.scratch_paths.emit.env]
projexp = "{home}/Documents/Scratch/exports"
scrcap  = "{home}/Documents/Scratch/screenshots"


# ===================================================================
# MODULES: APPS
# ===================================================================

[modules.apps]
enabled = true

# --------------------------------------------------
# core_homebrew (mac baseline PATH + brew shellenv)
# --------------------------------------------------
[modules.apps.core_homebrew]
enabled   = true
kind      = "cli"
platforms = ["mac"]
priority  = 10

[modules.apps.core_homebrew.detect.paths.mac]
any_of = ["/opt/homebrew/bin"]

[modules.apps.core_homebrew.emit.paths]
prepend_if_exists = [
  "{detect.path}",        # /opt/homebrew/bin
  "/opt/homebrew/sbin",
]
append_if_exists = []

[[modules.apps.core_homebrew.emit.init]]
command = "brew"
args = ["shellenv"]
pwsh_out_string = true

# --------------------------------------------------
# bat (MANPAGER)
# --------------------------------------------------
[modules.apps.bat]
enabled   = true
kind      = "cli"
priority  = 145
platforms = ["mac", "linux", "wsl", "other", "windows"]

[modules.apps.bat.detect.commands]
any_of = ["bat", "batcat"]

# Prefer bat if present (keeps man pages readable and colored)
[modules.apps.bat.emit.env]
MANPAGER = "sh -c 'col -bx | bat -l man -p'"


# --------------------------------------------------
# linux_homebrew (linux baseline PATH, cross-shell)
# --------------------------------------------------
[modules.apps.linux_homebrew]
enabled   = true
kind      = "cli"
priority  = 12
platforms = ["linux", "wsl"]

[modules.apps.linux_homebrew.detect.paths.linux]
any_of = [
  "/home/linuxbrew/.linuxbrew/bin",
  "{home}/.linuxbrew/bin",
]

[modules.apps.linux_homebrew.detect.paths.wsl]
any_of = [
  "/home/linuxbrew/.linuxbrew/bin",
  "{home}/.linuxbrew/bin",
]

[modules.apps.linux_homebrew.emit.paths]
prepend_if_exists = [
  "/home/linuxbrew/.linuxbrew/bin",
  "/home/linuxbrew/.linuxbrew/sbin",
  "{home}/.linuxbrew/bin",
  "{home}/.linuxbrew/sbin",
]
append_if_exists = []

# --------------------------------------------------
# core_userpaths (Orbit: ~/.local/bin)
# --------------------------------------------------
[modules.apps.core_userpaths]
enabled   = true
kind      = "cli"
priority  = 20
platforms = ["mac", "linux", "wsl", "other", "windows"]

[modules.apps.core_userpaths.detect.paths.mac]
any_of = ["{home}/.local/bin"]

[modules.apps.core_userpaths.detect.paths.linux]
any_of = ["{home}/.local/bin"]

[modules.apps.core_userpaths.detect.paths.wsl]
any_of = ["{home}/.local/bin"]

[modules.apps.core_userpaths.detect.paths.other]
any_of = ["{home}/.local/bin"]

# (optional) if you ever want it on native Windows too:
[modules.apps.core_userpaths.detect.paths.windows]
any_of = ["{userprofile}/.local/bin"]

[modules.apps.core_userpaths.emit.paths]
prepend_if_exists = ["{home}/.local/bin"]
append_if_exists  = []


# --------------------------------------------------
# terminfo helpers (push/check terminfo on remote)
# --------------------------------------------------
[modules.apps.terminfo]
enabled   = true
kind      = "cli"
priority  = 26
platforms = ["mac", "linux", "windows", "wsl", "other"]

# Only enable when the required tools exist
[modules.apps.terminfo.detect.commands]
any_of = ["infocmp", "tic", "ssh"]

[modules.apps.terminfo.emit.functions]
files = [
  "{config_dir}/functions/terminfo.{shell_family_ext}",
]


# --------------------------------------------------
# terminfo_dirs (cross-shell baseline)
# --------------------------------------------------
[modules.apps.terminfo_dirs]
enabled   = true
kind      = "cli"
priority  = 25
platforms = ["mac", "linux", "wsl", "other"]

[modules.apps.terminfo_dirs.detect.paths.mac]
any_of = ["/usr/bin"]

[modules.apps.terminfo_dirs.detect.paths.linux]
any_of = ["/usr/bin"]

[modules.apps.terminfo_dirs.detect.paths.wsl]
any_of = ["/usr/bin"]

[modules.apps.terminfo_dirs.detect.paths.other]
any_of = ["/usr/bin"]

[modules.apps.terminfo_dirs.emit.env]
TERMINFO_DIRS = "{home}/.terminfo:/usr/share/terminfo"


# --------------------------------------------------
# core_editor (no scripts, no hooks)
# Priority: nvim -> vim -> vi (first present wins)
# --------------------------------------------------

[modules.apps.core_editor]
enabled = true
kind = "cli"
priority = 30
platforms = []

[modules.apps.core_editor.detect.commands]
any_of = ["nvim", "vim", "vi"]

[modules.apps.core_editor.emit.env]
EDITOR     = "{detect.command}"
VISUAL     = "{detect.command}"
GIT_EDITOR = "{detect.command}"

# -------------------------------------------------------------------
# nvim
# -------------------------------------------------------------------
[modules.apps.nvim_aliases]
enabled   = true
kind      = "cli"
priority  = 31
platforms = ["mac", "linux", "windows", "wsl", "other"]

[modules.apps.nvim_aliases.detect.commands]
any_of = ["nvim"]

[modules.apps.nvim_aliases.emit.aliases]
vi  = "nvim"
vim = "nvim"

# -------------------------------------------------------------------
# core_macos_paths
# -------------------------------------------------------------------
[modules.apps.core_macos_paths]
enabled   = true
kind      = "cli"
priority  = 5
platforms = ["mac"]

# no detect needed? (but your system requires detect to activate)
# so: activate if /usr/bin exists (always true on mac)
[modules.apps.core_macos_paths.detect.paths.mac]
any_of = ["/usr/bin"]

[modules.apps.core_macos_paths.emit.paths]
prepend_if_exists = [
  "/usr/local/bin",
  "/usr/local/sbin",
]
append_if_exists = []


# ----------------------
# git (CLI app)
# ----------------------
[modules.apps.git]
enabled = true
kind = "cli"
priority = 40
platforms = []

[modules.apps.git.detect.commands]
any_of = ["git"]

[modules.apps.git.emit.aliases]
gs  = "git status"
gcp = "git_commit_push"
mb  = "merge_branch"
gbp = "git_blob_push"

[modules.apps.git.emit.functions]
files = [
  "{config_dir}/functions/git.{shell_family_ext}",
]

# -------------------------------------------------------------------
# 1Password CLI
# -------------------------------------------------------------------
[modules.apps.onepassword]
enabled  = true
kind     = "cli"
priority = 95
platforms = ["mac", "linux", "windows", "wsl", "other"]

[modules.apps.onepassword.detect.commands]
any_of = ["op"]

[modules.apps.onepassword.emit.env]
OP_CACHE = "true"

# ----------------------
# eza (CLI app)
# ----------------------
[modules.apps.eza]
enabled   = true
kind      = "cli"
priority = 50
platforms = ["mac", "linux", "windows", "wsl", "other"]

[modules.apps.eza.detect.commands]
any_of = ["eza"]

[modules.apps.eza.detect.version.all]
type = "command"
command = "eza"
args = ["--version"]
regex = "(?P<version>[0-9]+\\.[0-9]+\\.[0-9]+)"

[modules.apps.eza.emit.env]
USE_EZA            = "1"
EZA_CONFIG_DIR     = "{home}/.config/eza"
APOGEE_LS_ICONS    = "0"
APOGEE_DOTFILES_SGR = "90"

[modules.apps.eza.emit.functions]
files = [
  "{config_dir}/functions/eza.{shell_family_ext}",
]


# ----------------------
# cargo / rust (CLI toolchain)
# ----------------------
[modules.apps.cargo]
enabled = true
kind = "cli"
priority = 60
platforms = ["mac", "linux", "windows", "wsl", "other"]

[modules.apps.cargo.detect.commands]
any_of = ["cargo"]

[modules.apps.cargo.emit.env]
CARGO_TARGET_DIR = "{home}/.cache/cargo/targets"

# --------------------------------------------------
# pyenv (optional)
# --------------------------------------------------
[modules.apps.pyenv]
enabled   = true
kind      = "cli"
priority  = 110
platforms = ["mac", "linux", "wsl", "other"]

[modules.apps.pyenv.detect.paths.mac]
any_of = ["{home}/.pyenv"]

[modules.apps.pyenv.detect.paths.linux]
any_of = ["{home}/.pyenv"]

[modules.apps.pyenv.detect.paths.wsl]
any_of = ["{home}/.pyenv"]

[modules.apps.pyenv.detect.paths.other]
any_of = ["{home}/.pyenv"]

[modules.apps.pyenv.emit.env]
PYENV_ROOT = "{detect.path}"

[modules.apps.pyenv.emit.paths]
prepend_if_exists = ["$PYENV_ROOT/bin"]
append_if_exists  = []


# ----------------------
# starship (prompt)
# ----------------------
[modules.apps.starship]
enabled = true
kind = "cli"
priority = 70
platforms = ["mac", "linux", "windows", "wsl", "other"]

[modules.apps.starship.detect.commands]
any_of = ["starship"]

[modules.apps.starship.emit.env]
STARSHIP_CONFIG = "{xdg_config_home}/starship/starship_{shell}.toml"

[modules.apps.starship.emit.source]
files = [
  "{config_dir}/functions/starship_root_override.{shell_ext}"
]

[[modules.apps.starship.emit.init]]
command = "{detect.command_path}"
args = ["init", "{shell_init}"]
pwsh_out_string = false

# ----------------------
# zoxide (smarter cd)
# ----------------------
[modules.apps.zoxide]
enabled = true
kind = "cli"
priority = 80
platforms = ["mac", "linux", "windows", "wsl", "other"]

[modules.apps.zoxide.detect.commands]
any_of = ["zoxide"]

[[modules.apps.zoxide.emit.init]]
command = "{detect.command_path}"
args = ["init", "{shell_init}"]
pwsh_out_string = true

# --------------------------------------------------
# pixi (CLI toolchain)
# Orbit: PIXI_HOME + PATH + host-manifest helpers
# --------------------------------------------------
[modules.apps.pixi]
enabled   = true
kind      = "cli"
priority = 90
platforms = ["mac", "linux", "windows", "wsl", "other"]

[modules.apps.pixi.detect.paths.mac]
any_of = ["{home}/.pixi"]

[modules.apps.pixi.detect.paths.linux]
any_of = ["{home}/.pixi"]

[modules.apps.pixi.detect.paths.windows]
any_of = ["{userprofile}/.pixi"]

[modules.apps.pixi.detect.paths.wsl]
any_of = [
  "{home}/.pixi",
  "/mnt/c/Users/{username}/.pixi",
]

[modules.apps.pixi.detect.paths.other]
any_of = ["{home}/.pixi"]

[modules.apps.pixi.emit.env]
PIXI_HOME = "{detect.path}"

[modules.apps.pixi.emit.paths]
prepend_if_exists = ["$PIXI_HOME/bin"]
append_if_exists  = []

[modules.apps.pixi.emit.env_derived]
PIXIH_HOST_TRACKED = "{xdg_config_home}/pixi/hosts/{host}/.pixi/manifests/pixi-global.toml"
PIXIH_LIVE_LINK    = "$PIXI_HOME/manifests/pixi-global.toml"
PIXI_GLOBAL_FEATURES = "{platform}"

[modules.apps.pixi.emit.functions]
files = [
  "{config_dir}/functions/pixi.{shell_family_ext}",
]


# --------------------------------------------------
# uv (python tooling)
# --------------------------------------------------
[modules.apps.uv]
enabled   = true
kind      = "cli"
priority  = 100
platforms = ["mac", "linux", "windows", "wsl", "other"]

[modules.apps.uv.detect.commands]
any_of = ["uv"]

[modules.apps.uv.emit.env]
# Apogee-managed knobs (these feed python_env.*)
APOGEE_UV_VENV_ROOT        = "{home}/.venvs"
APOGEE_UV_DEFAULT_PY       = "auto-houdini"
APOGEE_UV_QUIET            = "0"
APOGEE_UV_SYNC_ON_ACTIVATE = "0"
APOGEE_UV_FORCE_SYNC       = "0"
APOGEE_USE_CONDA           = "0"

# uvâ€™s own locations
UV_TOOL_DIR      = "{home}/.local/share/uv/tools"
UV_TOOL_BIN_DIR  = "{home}/.local/share/uv/bin"

[modules.apps.uv.emit.paths]
prepend_if_exists = [
  "$UV_TOOL_BIN_DIR",
  "{home}/.local/share/uv/bin",
]
append_if_exists = []


[modules.apps.uv.emit.functions]
files = [
  "{config_dir}/functions/python_env.{shell_ext}",
]

# --------------------------------------------------
# fzf
# --------------------------------------------------
[modules.apps.fzf]
enabled = true
priority = 120
kind = "cli"

[modules.apps.fzf.detect.commands]
any_of = ["fzf"]

# Source completion + key-bindings (correct way)
[modules.apps.fzf.emit.source]
files = [
  # Homebrew mac
  "/opt/homebrew/opt/fzf/shell/completion.{shell_ext}",
  "/opt/homebrew/opt/fzf/shell/key-bindings.{shell_ext}",

  # Intel brew mac
  "/usr/local/opt/fzf/shell/completion.{shell_ext}",
  "/usr/local/opt/fzf/shell/key-bindings.{shell_ext}",

  # Linuxbrew (common)
  "/home/linuxbrew/.linuxbrew/opt/fzf/shell/completion.{shell_ext}",
  "/home/linuxbrew/.linuxbrew/opt/fzf/shell/key-bindings.{shell_ext}",

  # .fzf install
  "{home}/.fzf/shell/completion.{shell_ext}",
  "{home}/.fzf/shell/key-bindings.{shell_ext}",
]

[modules.apps.fzf.emit.functions]
files = [
  "{config_dir}/functions/fzf.{shell_family_ext}",
]

# --------------------------------------------------
# ripgrep (rg)
# --------------------------------------------------
[modules.apps.ripgrep]
enabled  = true
priority = 130
kind     = "cli"

[modules.apps.ripgrep.detect.commands]
any_of = ["rg"]

[modules.apps.ripgrep.emit.env]
RIPGREP_CONFIG_PATH = "{xdg_config_home}/ripgrep/ripgreprc"

[modules.apps.ripgrep.emit.aliases]
rgi = "rg --hidden --follow"
rgv = "rg --hidden --follow --glob '!**/.git/*'"

# --------------------------------------------------
# fd (pairs with the shared ignore file)
# --------------------------------------------------
[modules.apps.fd]
enabled  = true
priority = 135
kind     = "cli"

[modules.apps.fd.detect.commands]
any_of = ["fd", "fdfind"]

[modules.apps.fd.emit.env]
FD_OPTIONS = "--hidden --ignore-file={xdg_config_home}/search/ignore"

# --------------------------------------------------
# clipboard (pbcopy/pbpaste cross platform)
# --------------------------------------------------
[modules.apps.clipboard]
enabled   = true
kind      = "cli"
priority  = 150
platforms = ["mac", "linux", "windows", "wsl", "other"]

# Activate if *any* backend exists (or on pwsh we still want it)
[modules.apps.clipboard.detect.commands]
any_of = ["pbcopy", "wl-copy", "xclip", "xsel", "clip.exe", "powershell.exe", "pwsh", "powershell"]

[modules.apps.clipboard.emit.functions]
files = [
  "{config_dir}/functions/clipboard.{shell_family_ext}",
]

# --------------------------------------------------
# tmux_seg (fast STARSHIP_TMUX_SEG; no starship custom spawning)
# --------------------------------------------------
[modules.apps.tmux_seg]
enabled   = true
kind      = "cli"
priority  = 75
platforms = ["mac", "linux", "windows", "wsl", "other"]

# only install the hook if tmux exists on the machine
[modules.apps.tmux_seg.detect.commands]
any_of = ["tmux"]

[modules.apps.tmux_seg.emit.functions]
files = [
  "{config_dir}/functions/tmux_seg.{shell_ext}",
]


# --------------------------------------------------
# yazi (cd on exit helper)
# --------------------------------------------------
[modules.apps.yazi]
enabled   = true
kind      = "cli"
priority  = 140
platforms = ["mac", "linux", "wsl", "other"]

[modules.apps.yazi.detect.commands]
any_of = ["yazi"]

[modules.apps.yazi.emit.functions]
files = [
  "{config_dir}/functions/yazi.{shell_ext}",
]

# ===================================================================
# MODULES: TEMPLATES
# ===================================================================

[modules.templates]
enabled = true

[modules.templates.python_projects]
enabled  = true
priority = 200

# Require uv, and (optionally) dropbox if your template references PACKAGES/MATRIX etc.
requires = ["apps.uv", "cloud.dropbox"]

[modules.templates.python_projects.templates]
zsh  = "{config_dir}/templates/python_projects.zsh.j2"
bash = "{config_dir}/templates/python_projects.bash.j2"
fish = "{config_dir}/templates/python_projects.fish.j2"
pwsh = "{config_dir}/templates/python_projects.pwsh.j2"

[modules.templates.python_projects.data]
projects = [
  { name = "hdrUtils",       kind = "uv" },
  { name = "helperScripts",  kind = "uv" },
  { name = "Incept",         kind = "uv" },
  { name = "Ledu",           kind = "uv" },
  { name = "Lumiera",        kind = "uv" },
  { name = "notionManager",  kind = "uv" },
  { name = "oauthManager",   kind = "uv" },
  { name = "ocioTools",      kind = "uv" },
  { name = "pariVaha",       kind = "uv" },
  { name = "pythonKitchen",  kind = "uv" },
  { name = "webUtils",       kind = "uv" },
]

# ===================================================================
# Desktop apps
# ===================================================================

# -------------------------------------------------------------------
# Blender
# -------------------------------------------------------------------
[modules.apps.blender]
enabled = true

[modules.apps.blender.detect.paths.mac]
any_of = ["/Applications/Blender.app"]

[modules.apps.blender.detect.version.mac]
# single method is still valid
type = "mac_bundle_plist"
path = "{detect.path}"
key = "CFBundleShortVersionString"
regex = "(?P<version>\\d+\\.\\d+(?:\\.\\d+)?)"

[modules.apps.blender.emit.env]
BLENDER_VERSION = "{detect.version}"

# -------------------------------------------------------------------
# Houdini
# -------------------------------------------------------------------
[modules.apps.houdini]
enabled   = true
kind      = "desktop"
priority  = 160
platforms = ["mac", "linux", "wsl"]

[modules.apps.houdini.detect.paths.mac]
any_of = ["/Applications/Houdini/Houdini*"]

[modules.apps.houdini.detect.paths.linux]
any_of = ["/opt/hfs*"]

[modules.apps.houdini.detect.paths.wsl]
any_of = ["/opt/hfs*"]

[modules.apps.houdini.detect.version.all]
type = "path_regex"
regex = "(?:Houdini|hfs)(?P<version>[0-9]+\\.[0-9]+\\.[0-9]+)"
capture = "version"

[modules.apps.houdini.emit.env]
APOGEE_HAS_HOUDINI          = "1"
APOGEE_HOUDINI_DETECT_PATH  = "{detect.path}"
APOGEE_HOUDINI_DETECT_VERSION = "{detect.version}"

[modules.apps.houdini.emit.functions]
files = [
  "{config_dir}/functions/houdini.{shell_family_ext}",
]

# -------------------------------------------------------------------
# Nuke (Foundry) - desktop
# NOTE: current glob resolver can't match wildcards in parent dirs,
# so include explicit paths for now.
# -------------------------------------------------------------------
[modules.apps.nuke]
enabled   = true
kind      = "desktop"
priority  = 170
platforms = ["mac", "linux", "windows", "wsl", "other"]

# Activate if the CLI exists (common on linux/win setups),
# OR if the mac app is present (your explicit path still works).
[modules.apps.nuke.detect.commands]
any_of = ["nuke"]

[modules.apps.nuke.detect.paths.mac]
any_of = [
  "/Applications/Nuke*/Nuke*.app",
]

[modules.apps.nuke.detect.version.mac]
type = "mac_bundle_plist"
path = "{detect.path}"
key  = "CFBundleShortVersionString"
regex = "(?P<version>\\d+\\.\\d+(?:\\.\\d+)?)"

[modules.apps.nuke.emit.env]
APOGEE_HAS_NUKE         = "1"
APOGEE_NUKE_DETECT_PATH = "{detect.path}"
APOGEE_NUKE_VERSION     = "{detect.version}"
APOGEE_NUKE_DEFAULT     = "Nuke16.0v6"

[modules.apps.nuke.emit.functions]
files = [
  "{config_dir}/functions/nuke.{shell_family_ext}",
]


# ===================================================================
# MODULES: HOOKS (disabled by default)
# ===================================================================

[modules.hooks]
enabled = true


[[modules.hooks.items]]
name = "noop"
enabled = true
platforms = []
hosts = []
shells = []
script = "{config_dir}/hooks/noop.{shell_ext}"
