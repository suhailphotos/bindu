# ===================================================================
# apogee config v1
#
# Scope: env vars, PATH wiring, aliases.
# apogee will:
#   - detect platform (mac / linux / wsl / other)
#   - detect host (hostname -s)
#   - detect shell (zsh / bash / pwsh) via argv/env
#   - merge global + platform + host scopes
#   - emit shell code you can eval
# ===================================================================

[apogee]
schema_version = 1
default_shell  = "zsh"          # "zsh" | "bash" | "pwsh"
# optional: restrict platforms apogee knows about
platforms      = ["mac", "linux", "wsl", "other"]

# -------------------------------------------------------------------
# Global environment (applies everywhere, all shells)
# -------------------------------------------------------------------
[env.global]
XDG_CONFIG_HOME   = "$HOME/.config"
# You can still override these per-host if needed.
EDITOR            = "nvim"
VISUAL            = "nvim"
GIT_EDITOR        = "nvim"

# Shared roots (defined in terms of other vars)
MATRIX            = "$DROPBOX/matrix"
DOCKER            = "$MATRIX/docker"
BASE_DIR          = "$MATRIX/shellscripts"
PACKAGES          = "$MATRIX/packages"
CRATES            = "$MATRIX/crates"

# Synology / course / vault
ML4VFX            = "$DATALIB/threeD/courses/05_Machine_Learning_in_VFX"
OBSIDIAN          = "$MATRIX/obsidian/jnanaKosha"

# uv defaults
UV_VENV_ROOT   = "$HOME/.venvs"       # external envs
UV_DEFAULT_PY  = "auto-houdini"       # or "3.12", "/usr/local/bin/python3.12", etc.
UV_TOOL_DIR          = "$HOME/.local/share/uv/tools"
UV_TOOL_BIN_DIR      = "$HOME/.local/share/uv/bin"

# zoxide toggle
USE_ZOXIDE     = "1"                  # 1 = init zoxide, 0 = skip

# Colors / pager defaults
LESS                 = "-R"
PAGER                = "less"

# eza-related toggles (apogee can turn these into aliases if eza exists)
USE_EZA        = "1"
LS_ICONS       = "0"
DOTFILES_SGR   = "90"                 # for dimming dotfiles via EZA_COLORS

# Locale fallback used by your "force UTF-8" logic
DEFAULT_LOCALE = "C.UTF-8"

# Search (apogee can choose to only export if files exist)
RIPGREP_CONFIG_PATH  = "$XDG_CONFIG_HOME/ripgrep/ripgreprc"
FD_OPTIONS           = "--hidden --ignore-file=$XDG_CONFIG_HOME/search/ignore"

# Terminfo: always prefer ~/.terminfo first
TERMINFO_DIRS        = "$HOME/.terminfo:/usr/share/terminfo"

# Cargo global target dir (keeps Dropbox / repos clean)
CARGO_TARGET_DIR     = "$HOME/.cache/cargo/targets"

# bindu defaults (autosync for ~/.config)
BINDU_DIR            = "$XDG_CONFIG_HOME"
BINDU_REMOTE         = "origin"
BINDU_FETCH_INTERVAL = "600"   # seconds
BINDU_AUTO_FF_PULL   = "1"
BINDU_AUTOSYNC       = "0"     # 1 = enable autosync on prompt

# -------------------------------------------------------------------
# Per-platform env (primary differences: DROPBOX, DATALIB, NEBULA, iCloud)
# platform keys: "mac", "linux", "wsl", "other"
# -------------------------------------------------------------------

[env.platform.mac]
DROPBOX                = "$HOME/Library/CloudStorage/Dropbox"
DATALIB                = "$HOME/Library/CloudStorage/SynologyDrive-dataLib"
NEBULA_AI_ROOT         = "/Volumes/ai"
# Neovim background hint for remote hosts (apogee can derive logic from this)
NVIM_BG_MODE           = "auto"          # "auto" | "light" | "dark"

# Mac-specific convenience paths
scrcap                 = "$HOME/Documents/Scratch/screenshots"
projexp                = "$HOME/Documents/Scratch/exports"

[env.platform.linux]
DROPBOX                = "$HOME/Dropbox"
DATALIB                = "/mnt/dataLib"
NEBULA_AI_ROOT         = "/mnt/ai"

# iCloud-over-SSHFS wiring for Linux hosts
ICLOUD_HOST        = "quasar"
ICLOUD_REMOTE_PATH = "Documents"
ICLOUD_IDENTITY    = "$HOME/.ssh/id_quasar"
ICLOUD_MOUNT_ROOT  = "$HOME/icloudDocs"
projexp                  = "$ICLOUD_MOUNT_ROOT/Scratch/exports"

[env.platform.wsl]
DROPBOX                = "$USERPROFILE/Dropbox"
DATALIB                = "$USERPROFILE/Synology-dataLib"
NEBULA_AI_ROOT         = "Z:/ai"

[env.platform.other]
# generic fallbacks
DROPBOX                = "$HOME/Dropbox"
DATALIB                = "$HOME/Synology-dataLib"
NEBULA_AI_ROOT         = "$HOME/ai"

# -------------------------------------------------------------------
# NEBULA AI derived paths (shared; only meaningful if NEBULA_AI_ROOT exists)
# -------------------------------------------------------------------
[env.nebula]
NEBULA_AI_MODELS      = "$NEBULA_AI_ROOT/models"
NEBULA_AI_DATASETS    = "$NEBULA_AI_ROOT/datasets"
NEBULA_AI_EXPERIMENTS = "$NEBULA_AI_ROOT/experiments"
NEBULA_AI_LOGS        = "$NEBULA_AI_ROOT/logs"
NEBULA_AI_SCRIPTS     = "$NEBULA_AI_ROOT/scripts"
NEBULA_AI_PROJECTS    = "$NEBULA_AI_ROOT/projects"

# -------------------------------------------------------------------
# Per-host env overrides / extras
# host names should match `hostname -s`
# -------------------------------------------------------------------

[env.host.nimbus]
# Prefer Conda on this host for generic envs
USE_CONDA   = "1"

# CUDA wiring
CUDA_HOME         = "/usr/local/cuda"
LD_LIBRARY_PATH   = "$CUDA_HOME/lib64:$LD_LIBRARY_PATH"

# Quick SSH shortcuts to your Mac
macdocs           = "quasar:~/Documents"
macnotes          = "quasar:~/Documents/Scratch/notes"
macexports        = "quasar:~/Documents/Scratch/exports"

[env.host.flicker]
# Flicker-specific flags can go here
USE_CONDA   = "0"

[env.host.nexus]
# Nexus-specific flags
USE_CONDA   = "0"

# -------------------------------------------------------------------
# PATH wiring
#
# apogee can:
#   - start from existing PATH
#   - apply global.prepend_if_exists / append_if_exists
#   - then platform.*, then host.*
#   - dedupe entries while preserving first occurrence
#   - wrap each in "if [ -d dir ]; then ..." for POSIX shells
# -------------------------------------------------------------------

[paths.global]
# added first (closest to "front")
prepend_if_exists = [
  "$HOME/.local/bin",
  "$UV_TOOL_BIN_DIR"
]
append_if_exists = []

[paths.platform.mac]
prepend_if_exists = [
  "/opt/homebrew/bin",
  "/usr/local/bin"
]
append_if_exists  = []

[paths.platform.linux]
prepend_if_exists = [
  "/usr/local/bin",
  "/usr/bin"
]
append_if_exists  = []

[paths.platform.wsl]
prepend_if_exists = [
  "/usr/bin",
  "/usr/local/bin"
]
append_if_exists  = []

[paths.host.nimbus]
prepend_if_exists = [
  "$HOME/.cargo/bin"
]
append_if_exists  = []

[paths.host.flicker]
prepend_if_exists = [
  "$HOME/.cargo/bin"
]
append_if_exists  = []

[paths.host.nexus]
prepend_if_exists = [
  "$HOME/.cargo/bin"
]
append_if_exists  = []

# -------------------------------------------------------------------
# Projects (Orbit's PROJECTS list, but generic)
# apogee can later generate helpers or just expose this in env.
# -------------------------------------------------------------------

[projects]
managed = [
  "usdUtils",
  "oauthManager",
  "pythonKitchen",
  "ocioTools",
  "helperScripts",
  "Incept",
  "pariVaha",
  "Lumiera",
  "Ledu",
  "hdrUtils",
]

# Packages that normally want Houdini (for future: hou-aware helpers)
houdini_packages = [
  "houdiniLab",
  "houdiniUtils",
]

# -------------------------------------------------------------------
# Aliases
#
# apogee should:
#   - emit global aliases first
#   - then platform, then host (later wins on conflicts)
#   - translate into appropriate alias syntax per shell:
#       zsh/bash:   alias name='body'
#       pwsh:       Set-Alias -Name name -Value 'body'  (or wrapper function)
# -------------------------------------------------------------------

[aliases.global]
# Editors / navigation
nv        = "nvim"
matrix    = "cd \"$MATRIX\""
packages  = "cd \"$PACKAGES\""
crates    = "cd \"$CRATES\""
bindu     = "cd \"$XDG_CONFIG_HOME\""

# Git
gs        = "git status"
lg        = "lazygit"

# Top-level projects
orbit     = "cd \"$DROPBOX/matrix/orbit\""
helix     = "cd \"$DROPBOX/matrix/helix\""
tessera   = "cd \"$DROPBOX/matrix/tessera\""
truss     = "cd \"$DROPBOX/matrix/truss\""
iris      = "cd \"$DROPBOX/matrix/iris\""
atrium    = "cd \"$DROPBOX/matrix/atrium\""

# Rust crates
apogee    = "cd \"$DROPBOX/matrix/crates/apogee\""
swivel    = "cd \"$DROPBOX/matrix/crates/swivel\""
rillio    = "cd \"$DROPBOX/matrix/crates/rillio\""
rusk      = "cd \"$DROPBOX/matrix/crates/rusk\""

# Neovim projects
lilac     = "cd \"$DROPBOX/matrix/lilac\""
mira      = "cd \"$DROPBOX/matrix/mira\""
notio     = "cd \"$DROPBOX/matrix/nvim/notio\""

[aliases.platform.mac]
o         = "open ."

[aliases.platform.linux]
o         = "xdg-open ."

[aliases.host.nimbus]
nvidia    = "nvidia-smi"
gpustats  = "watch -n1 nvidia-smi"
