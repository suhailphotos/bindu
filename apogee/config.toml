# ===================================================================
# apogee config v2
#
# Scope:
#   - env vars
#   - PATH wiring
#   - aliases
#   - detection-based modules (cloud, apps, custom hooks)
#
# apogee will:
#   - detect platform (mac | linux | wsl | other)
#   - detect host (hostname -s)
#   - detect shell (zsh | bash | pwsh) via env/argv
#   - run detection modules
#   - merge global + platform + host scopes
#   - emit shell code to eval in rc files
# ===================================================================

[apogee]
schema_version = 2
default_shell  = "zsh"          # "zsh" | "bash" | "pwsh"
platforms      = ["mac", "linux", "wsl", "other"]

# -------------------------------------------------------------------
# Modules: detection-style "blocks" inspired by starship modules
# -------------------------------------------------------------------

[modules]
enable_cloud = true   # toggle all cloud modules
enable_apps  = true   # toggle all app modules
enable_hooks = true   # toggle custom hook scripts

# ----------------------
# Cloud storage modules
# ----------------------
[modules.cloud]
enabled = true

# If a candidate path exists, set DROPBOX=<that path>
# First match wins.
[modules.cloud.dropbox]
enabled   = true
platforms = ["mac", "linux", "wsl", "other"]
candidate_paths = [
  "$HOME/Library/CloudStorage/Dropbox",  # mac
  "$HOME/Dropbox",                       # linux, generic
  "$USERPROFILE/Dropbox",                # windows / wsl
]
set_env = "DROPBOX"

# If a candidate path exists, set DATALIB=<that path>
[modules.cloud.synology_datalib]
enabled   = true
platforms = ["mac", "linux", "wsl", "other"]
candidate_paths = [
  "$HOME/Library/CloudStorage/SynologyDrive-dataLib",  # mac
  "/mnt/dataLib",                                      # linux
  "$USERPROFILE/Synology-dataLib",                     # wsl/win
]
set_env = "DATALIB"

# Nebula AI root detection; overrides NEBULA_AI_ROOT if present
[modules.cloud.nebula_ai]
enabled   = true
platforms = ["mac", "linux"]
candidate_paths = [
  "/Volumes/ai",  # mac
  "/mnt/ai",      # linux
]
set_env = "NEBULA_AI_ROOT"

# ----------------------
# App / tool modules
# ----------------------
[modules.apps]
enabled = true

# example semantics:
#   - if `command` exists in PATH, then:
#       - apply env overrides
#       - emit aliases listed here
#
# apogee can also respect per-platform/host guards later.

[modules.apps.eza]
enabled       = true
command       = "eza"
env = { USE_EZA = "1" }
aliases = {
  ls = "eza",
  ll = "eza -l",
  la = "eza -la"
}

[modules.apps.zoxide]
enabled       = true
command       = "zoxide"
env = { USE_ZOXIDE = "1" }
# apogee can generate the proper `eval "$(zoxide init <shell>)"` per shell.

[modules.apps.ripgrep]
enabled       = true
command       = "rg"
env = { RIPGREP_CONFIG_PATH = "$XDG_CONFIG_HOME/ripgrep/ripgreprc" }

[modules.apps.fd]
enabled       = true
command       = "fd"
env = { FD_OPTIONS = "--hidden --ignore-file=$XDG_CONFIG_HOME/search/ignore" }

[modules.apps.nvim]
enabled       = true
command       = "nvim"
env = { EDITOR = "nvim", VISUAL = "nvim", GIT_EDITOR = "nvim" }

# You can add more app modules later:
# [modules.apps.houdini]
# enabled = true
# detect_files = ["/opt/hfs", "/Applications/Houdini*.app"]

# ----------------------
# Custom hooks (user scripts)
# ----------------------
# apogee does not interpret these; it just runs/sources them
# when the conditions match (platform/hosts/shells).
#
# You can use this for things apogee doesn’t know about yet.

[[modules.custom]]
name      = "after-core-linux"
enabled   = true
platforms = ["linux"]
hosts     = ["nimbus", "flicker", "nexus"]
shells    = ["zsh", "bash"]
script    = "$HOME/.config/apogee/hooks/after-core-linux.sh"

[[modules.custom]]
name      = "after-core-mac"
enabled   = true
platforms = ["mac"]
shells    = ["zsh", "bash"]
script    = "$HOME/.config/apogee/hooks/after-core-mac.sh"

# ===================================================================
# ENVIRONMENT
# ===================================================================

# -------------------------------------------------------------------
# Global environment (applies everywhere, all shells)
# -------------------------------------------------------------------
[env.global]
XDG_CONFIG_HOME   = "$HOME/.config"

EDITOR            = "nvim"
VISUAL            = "nvim"
GIT_EDITOR        = "nvim"

# Shared roots (defined in terms of other vars)
MATRIX            = "$DROPBOX/matrix"
DOCKER            = "$MATRIX/docker"
BASE_DIR          = "$MATRIX/shellscripts"
PACKAGES          = "$MATRIX/packages"
CRATES            = "$MATRIX/crates"

# Synology / course / vault
ML4VFX            = "$DATALIB/threeD/courses/05_Machine_Learning_in_VFX"
OBSIDIAN          = "$MATRIX/obsidian/jnanaKosha"

# uv defaults
UV_VENV_ROOT      = "$HOME/.venvs"       # external envs
UV_DEFAULT_PY     = "auto-houdini"       # or "3.12", etc.
UV_TOOL_DIR       = "$HOME/.local/share/uv/tools"
UV_TOOL_BIN_DIR   = "$HOME/.local/share/uv/bin"

# zoxide toggle (may be overridden by modules.apps.zoxide)
USE_ZOXIDE        = "1"

# base toggles
USE_CONDA         = "0"
USE_EZA           = "1"                  # modules.eza may enforce this

# Colors / pager defaults
LESS              = "-R"
PAGER             = "less"

# Search defaults (may be overridden by modules.apps.*)
RIPGREP_CONFIG_PATH  = "$XDG_CONFIG_HOME/ripgrep/ripgreprc"
FD_OPTIONS           = "--hidden --ignore-file=$XDG_CONFIG_HOME/search/ignore"

# Terminfo: prefer ~/.terminfo first
TERMINFO_DIRS        = "$HOME/.terminfo:/usr/share/terminfo"

# Cargo global target dir (keeps Dropbox / repos clean)
CARGO_TARGET_DIR     = "$HOME/.cache/cargo/targets"

# bindu defaults (autosync for ~/.config)
BINDU_DIR            = "$XDG_CONFIG_HOME"
BINDU_REMOTE         = "origin"
BINDU_FETCH_INTERVAL = "600"   # seconds
BINDU_AUTO_FF_PULL   = "1"
BINDU_AUTOSYNC       = "0"     # 1 = enable autosync on prompt

# Locale fallback used by your UTF-8 logic
DEFAULT_LOCALE       = "C.UTF-8"

# -------------------------------------------------------------------
# Per-platform env (keys: mac, linux, wsl, other)
# These are applied after env.global.
# Cloud-related vars may get overridden by modules.cloud.* detection.
# -------------------------------------------------------------------

[env.platform.mac]
# If modules.cloud.dropbox is enabled, DROPBOX will be detected.
# If not found, this acts as a fallback.
DROPBOX                = "$HOME/Library/CloudStorage/Dropbox"
DATALIB                = "$HOME/Library/CloudStorage/SynologyDrive-dataLib"
NEBULA_AI_ROOT         = "/Volumes/ai"

NVIM_BG_MODE           = "auto"          # "auto" | "light" | "dark"

scrcap                 = "$HOME/Documents/Scratch/screenshots"
projexp                = "$HOME/Documents/Scratch/exports"

[env.platform.linux]
# Fallbacks; modules may override them
DROPBOX                = "$HOME/Dropbox"
DATALIB                = "/mnt/dataLib"
NEBULA_AI_ROOT         = "/mnt/ai"

# iCloud-over-SSHFS wiring for Linux hosts
ICLOUD_HOST            = "quasar"
ICLOUD_REMOTE_PATH     = "Documents"
ICLOUD_IDENTITY        = "$HOME/.ssh/id_quasar"
ICLOUD_MOUNT_ROOT      = "$HOME/icloudDocs"
projexp                = "$ICLOUD_MOUNT_ROOT/Scratch/exports"

[env.platform.wsl]
DROPBOX                = "$USERPROFILE/Dropbox"
DATALIB                = "$USERPROFILE/Synology-dataLib"
NEBULA_AI_ROOT         = "Z:/ai"

[env.platform.other]
DROPBOX                = "$HOME/Dropbox"
DATALIB                = "$HOME/Synology-dataLib"
NEBULA_AI_ROOT         = "$HOME/ai"

# -------------------------------------------------------------------
# NEBULA AI derived paths (only meaningful if NEBULA_AI_ROOT exists)
# apogee can choose to set these only if NEBULA_AI_ROOT is present.
# -------------------------------------------------------------------
[env.nebula]
NEBULA_AI_MODELS      = "$NEBULA_AI_ROOT/models"
NEBULA_AI_DATASETS    = "$NEBULA_AI_ROOT/datasets"
NEBULA_AI_EXPERIMENTS = "$NEBULA_AI_ROOT/experiments"
NEBULA_AI_LOGS        = "$NEBULA_AI_ROOT/logs"
NEBULA_AI_SCRIPTS     = "$NEBULA_AI_ROOT/scripts"
NEBULA_AI_PROJECTS    = "$NEBULA_AI_ROOT/projects"

# -------------------------------------------------------------------
# Per-host env overrides / extras
# host names should match `hostname -s`
# -------------------------------------------------------------------

[env.host.nimbus]
USE_CONDA       = "1"

CUDA_HOME       = "/usr/local/cuda"
LD_LIBRARY_PATH = "$CUDA_HOME/lib64:$LD_LIBRARY_PATH"

macdocs         = "quasar:~/Documents"
macnotes        = "quasar:~/Documents/Scratch/notes"
macexports      = "quasar:~/Documents/Scratch/exports"

[env.host.flicker]
USE_CONDA       = "0"

[env.host.nexus]
USE_CONDA       = "0"

# ===================================================================
# PATH wiring
# ===================================================================

[paths.global]
prepend_if_exists = [
  "$HOME/.local/bin",
  "$UV_TOOL_BIN_DIR",
]
append_if_exists = []

[paths.platform.mac]
prepend_if_exists = [
  "/opt/homebrew/bin",
  "/usr/local/bin",
]
append_if_exists  = []

[paths.platform.linux]
prepend_if_exists = [
  "/usr/local/bin",
  "/usr/bin",
]
append_if_exists  = []

[paths.platform.wsl]
prepend_if_exists = [
  "/usr/bin",
  "/usr/local/bin",
]
append_if_exists  = []

[paths.platform.other]
prepend_if_exists = []
append_if_exists  = []

[paths.host.nimbus]
prepend_if_exists = [
  "$HOME/.cargo/bin",
]
append_if_exists  = []

[paths.host.flicker]
prepend_if_exists = [
  "$HOME/.cargo/bin",
]
append_if_exists  = []

[paths.host.nexus]
prepend_if_exists = [
  "$HOME/.cargo/bin",
]
append_if_exists  = []

# ===================================================================
# Projects (Orbit's PROJECTS → generic)
# ===================================================================

[projects]
managed = [
  "usdUtils",
  "oauthManager",
  "pythonKitchen",
  "ocioTools",
  "helperScripts",
  "Incept",
  "pariVaha",
  "Lumiera",
  "Ledu",
  "hdrUtils",
]

houdini_packages = [
  "houdiniLab",
  "houdiniUtils",
]

# ===================================================================
# Aliases
# ===================================================================

[aliases.global]
nv        = "nvim"
matrix    = "cd \"$MATRIX\""
packages  = "cd \"$PACKAGES\""
crates    = "cd \"$CRATES\""
bindu     = "cd \"$XDG_CONFIG_HOME\""

# Git
gs        = "git status"
lg        = "lazygit"

# Top-level projects
orbit     = "cd \"$DROPBOX/matrix/orbit\""
helix     = "cd \"$DROPBOX/matrix/helix\""
tessera   = "cd \"$DROPBOX/matrix/tessera\""
truss     = "cd \"$DROPBOX/matrix/truss\""
iris      = "cd \"$DROPBOX/matrix/iris\""
atrium    = "cd \"$DROPBOX/matrix/atrium\""

# Rust crates
apogee    = "cd \"$DROPBOX/matrix/crates/apogee\""
swivel    = "cd \"$DROPBOX/matrix/crates/swivel\""
rillio    = "cd \"$DROPBOX/matrix/crates/rillio\""
rusk      = "cd \"$DROPBOX/matrix/crates/rusk\""

# Neovim projects
lilac     = "cd \"$DROPBOX/matrix/lilac\""
mira      = "cd \"$DROPBOX/matrix/mira\""
notio     = "cd \"$DROPBOX/matrix/nvim/notio\""

[aliases.platform.mac]
o         = "open ."

[aliases.platform.linux]
o         = "xdg-open ."

[aliases.platform.wsl]
o         = "explorer.exe ."

[aliases.host.nimbus]
nvidia    = "nvidia-smi"
gpustats  = "watch -n1 nvidia-smi"
